package io.zemke.github.bib;

import org.json.JSONObject;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestParam;

import java.io.IOException;
import java.net.URI;
import java.net.URL;
import java.net.http.HttpClient;
import java.net.http.HttpRequest;
import java.net.http.HttpResponse;
import java.util.Arrays;
import java.util.Base64;
import java.util.List;

@Controller
public class MainController {

    public static final String CHECK = "https://open.stadt-muenster.de/DesktopModules/OCLC.OPEN.PL.DNN.SearchModule/SearchService.asmx/GetAvailability";

    private BookRepository bookRepository;

    @Autowired
    public MainController(BookRepository bookRepository) {
        this.bookRepository = bookRepository;
    }

    @GetMapping("/")
    public String index(Model model) {
        model.addAttribute("idOrLink", "");
        return "index.html";
    }

    @PostMapping("/")
    public String index(@RequestParam String idOrLink, Model model) throws IOException, InterruptedException {
        String id;
        if (idOrLink.contains("http") || idOrLink.contains(".de") || idOrLink.contains("www") || idOrLink.contains("stadt")) {
            // link
            List<String> qq = Arrays.asList(new URL(idOrLink).getQuery().split("="));
            int idxId = qq.indexOf("id");
            if (qq.size() < 2 || idxId < 0) {
                return "index.html";
            }
            id = qq.get(idxId + 1);
        } else {
            id = idOrLink;
        }

        if (bookRepository.findById(id).isPresent()) {
            return "index.html";
        }

        /*
        var body = "{'portalId':0,'mednr':'" + id + "','culture':'de-DE','branchFilter':'','requestCopyData':true}";
        HttpRequest request = HttpRequest.newBuilder()
                .uri(URI.create(CHECK))
                .header("Content-Type", "application/json;charset=utf-8")
                .header("Accept", "application/json")
                .POST(HttpRequest.BodyPublishers.ofString(body))
                .build();
        HttpResponse<String> response = HttpClient.newHttpClient().send(request,
                HttpResponse.BodyHandlers.ofString());
        var response = """
                    {"d":{"__type":"OCLC.OPEN.PL.DNN.SearchModule.SearchService+AvailResponse","IsAvail":"true","CopyData":"\\u003cdiv\\u003e\\r\\n\\t\\u003ctable class=\\"oclc-module-table\\" tabindex=\\"0\\" id=\\"0980443_grdViewMediumCopies\\"\\u003e\\r\\n\\t\\t\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003cth scope=\\"col\\" abbr=\\"Bücherei\\"\\u003eBücherei\\u003c/th\\u003e\\u003cth scope=\\"col\\" abbr=\\"Bereich\\"\\u003eBereich\\u003c/th\\u003e\\u003cth scope=\\"col\\" abbr=\\"Standorte\\"\\u003eStandorte\\u003c/th\\u003e\\u003cth scope=\\"col\\" abbr=\\"Status\\"\\u003eStatus\\u003c/th\\u003e\\u003cth scope=\\"col\\" abbr=\\"Frist\\"\\u003eFrist\\u003c/th\\u003e\\u003cth scope=\\"col\\" abbr=\\"Vorbestellungen\\"\\u003eVorbestellungen\\u003c/th\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eB\\u0026#252;cherbus\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eVerf\\u0026#252;gbar\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eCoerde\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e26.08.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eCoerde\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman-Taschenbuch\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e04.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eGievenb.-St. Michael\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eWELLS / moderne Unterhaltung\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eVerf\\u0026#252;gbar\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHansaplatz\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman-Taschenbuch\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e04.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHansaplatz\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e13.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eVerf\\u0026#252;gbar\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e18.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e30.08.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e10.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e11.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e29.08.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eKinderhaus\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eVerf\\u0026#252;gbar\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\"oclc-module-view-small oclc-module-label\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\r\\n\\t\\u003c/table\\u003e\\r\\n\\u003c/div\\u003e\\r\\n\\r\\n","EMediumLink":""}}
                """.trim();
         */
        var response = "{\"d\":{\"__type\":\"OCLC.OPEN.PL.DNN.SearchModule.SearchService+AvailResponse\",\"IsAvail\":\"true\",\"CopyData\":\"\\u003cdiv\\u003e\\r\\n\\t\\u003ctable class=\\\"oclc-module-table\\\" tabindex=\\\"0\\\" id=\\\"0980443_grdViewMediumCopies\\\"\\u003e\\r\\n\\t\\t\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003cth scope=\\\"col\\\" abbr=\\\"Bücherei\\\"\\u003eBücherei\\u003c/th\\u003e\\u003cth scope=\\\"col\\\" abbr=\\\"Bereich\\\"\\u003eBereich\\u003c/th\\u003e\\u003cth scope=\\\"col\\\" abbr=\\\"Standorte\\\"\\u003eStandorte\\u003c/th\\u003e\\u003cth scope=\\\"col\\\" abbr=\\\"Status\\\"\\u003eStatus\\u003c/th\\u003e\\u003cth scope=\\\"col\\\" abbr=\\\"Frist\\\"\\u003eFrist\\u003c/th\\u003e\\u003cth scope=\\\"col\\\" abbr=\\\"Vorbestellungen\\\"\\u003eVorbestellungen\\u003c/th\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eB\\u0026#252;cherbus\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eVerf\\u0026#252;gbar\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eCoerde\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e26.08.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eCoerde\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman-Taschenbuch\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e04.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eGievenb.-St. Michael\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eWELLS / moderne Unterhaltung\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eVerf\\u0026#252;gbar\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHansaplatz\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman-Taschenbuch\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e04.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHansaplatz\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e13.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eVerf\\u0026#252;gbar\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e18.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e30.08.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e10.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e11.09.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eHauptstelle\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung / 1. Obergeschoss\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eEntliehen\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e29.08.2024\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\u003ctr\\u003e\\r\\n\\t\\t\\t\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStadtteilbücherei:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eKinderhaus\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eBereich:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eRoman\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStandorte:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003emoderne Unterhaltung\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eStatus:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003eVerf\\u0026#252;gbar\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eFrist:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\u003ctd\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan class=\\\"oclc-module-view-small oclc-module-label\\\"\\u003eVorbestellungen:\\u003c/span\\u003e\\r\\n\\t\\t\\t\\t\\u003cspan\\u003e0\\u003c/span\\u003e\\r\\n\\t\\t\\t\\u003c/td\\u003e\\r\\n\\t\\t\\u003c/tr\\u003e\\r\\n\\t\\u003c/table\\u003e\\r\\n\\u003c/div\\u003e\\r\\n\\r\\n\",\"EMediumLink\":\"\"}}";
        var j = new JSONObject(response).getJSONObject("d");

        var avail = j.getBoolean("IsAvail");
        var html = j.getString("CopyData")
                .replaceAll("\\r\\n", "")
                .replaceAll("\\t", "");

        /*
        var requestDetail = HttpRequest.newBuilder()
                .uri(URI.create("https://open.stadt-muenster.de/?id=" + id))
                .header("Content-Type", "text/html,application/xhtml+xml,application/xml")
                .POST(HttpRequest.BodyPublishers.ofString(body))
                .build();
        HttpResponse<String> responseDetailHtml = HttpClient.newHttpClient().send(requestDetail,
                HttpResponse.BodyHandlers.ofString());

        var name = Jsoup.parse(responseDetailHtml.body())
                .selectXpath("/html/head/meta[@property=\"og:title\"]")
                .getFirst().attr("content");
         */

        var name = "Vom Ende der Einsamkeit"; // 0980443
        var book = new Book(id).setHtml(html).setAvail(avail).setName(name);
        bookRepository.save(book);

        model.addAttribute("idOrLink", "");
        return "index.html";
    }
}

